---
title: "HW1 Solution"
author: "Gustavo"
date: "9/29/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Homework 1


Using the [Gout](https://raw.githubusercontent.com/gdlc/STAT_COMP/master/DATA/goutData.txt) data set:

**1)** Fit a linear model of the form  `su~race+sex+age`, report your results, and summarize (in no more than three sentences) your conclusions.


```{r}
 DATA=read.table("https://raw.githubusercontent.com/gdlc/STAT_COMP/master/DATA/goutData.txt",header=TRUE)
 fm1=lm(su~race+sex+age,data=DATA)
 summary(fm1)
```

**Remarks**: Both sex and race have significant effects on serum-urate levels. Male had higher SU than female, white had lower levels than black. Age has a marginally significant effect, with an indication of a slight increase of SU with age (0.0267 untis per year).



**2)** Consider now expanding the model to include race-by-sex interactions. 


  - Explain with words what an interaction term different than zero means in this model.
  - Fit the model with the interaction term, report your results and conclusions.



```{r}
  fm2<-lm(su~race+race*sex+age,data=DATA)
  summary(fm2)
```
The estimated effect for the interaction was positive, suggesting that the difference between male and female is slightly higher for white than for black people. However, the evidence is weak, and the interaction is not significantly different than zero. 



**3)** Consider now testing the hypothesis that sex has **any** effect on su (it could be an effect dependent on race or independent of it) versus the null that states that sex has no effect on su. 

  - Describe the null and the alternative hypothesis,

  - Test the null using `anova()`, and
  - Summarize your findings.


```{r}
 fm0=lm(su~race+age,data=DATA)
 anova(fm0,fm2)
```

**Remark:** We conclude that sex has an effect on SU.


**4) Reproducing the results of the F-test**:  

  - Review the F-statistic in the [class notes](https://github.com/gdlc/STAT_COMP/blob/master/HANDOUTS/OLS.pdf) and

  - Develop a function that takes as input two `lm` objects and return a table identical to the one produced by `anova()`. 
  - Test your function using the H0 and Ha you used in Q3.



```{r}
 myANOVA=function(fm0,fm1){
   df0=length(coef(fm0))
   df1=length(coef(fm1))
   n=length(residuals(fm1))
   RSS0=sum(residuals(fm0)^2)   
   RSS1=sum(residuals(fm1)^2)  
   
   FSTAT=((RSS0-RSS1)/(df1-df0))/(RSS1/(n-df1))
   
   ANS=cbind('RES.DF'=c(n-df0,n-df1),'RSS'=c(RSS0,RSS1),DF=c(NA,df1-df0),
            'Sum of Sq'=c(NA,RSS0-RSS1),
            'F'=c(NA,FSTAT),
            'pValue'=c(NA,pf(lower.tail=FALSE,df1=df1-df0,df2=n-df1,q=FSTAT)))
   return(ANS)
 }
```


**Comparison**

```{r}
 anova(fm0,fm2)
 myANOVA(fm0,fm2)

```





**5)** Wald's test

Like the F-test, Wald's test can also be used for tests involving 1 or more than 1 df. The test can be used with any null that can be expressed in linear form. The general form of the test is as follows:

  - **Ha**: **y=Xb+e** (for this case use your Ha of Q3). Here, **y** is a nx1 vector (the *response*), **X** is an nxp incidence matrix for the pxy vector of effects **b**, and **e** is an nx1 error vector.
  - **H0**:  **Tb=a**, where  **T** is a contrast matrix of dimensions qxp, and **a** is a qx1 vector (often **a=0**).

The covariance matrix of the contrast ($\mathbf{\hat{d}=T\hat{b}}$) is $Cov(\mathbf{\hat{d}})=\mathbf{TCov(\hat{b})T'}=\mathbf{S}$, where $Cov(\hat{b})$ is the (co)variance matrix of estimates (Hint: use vcov(fm) to obtain it, here fm is the fitted alternative hypothesis). Note: here $\mathbf{\hat{b}}$ is the OLS estimate of **b** from Ha.

Because of the CLT, in large samples, $\mathbf{\hat{d}=T}\hat{\mathbf{b}}$  follows a multivariate normal distribution with (co)variance matrix **S**. Therefore, under the null, $(\mathbf{\hat{d}-a})'\mathbf{S}^{-1}(\mathbf{\hat{d}-a})$ follows a chi-square distribution with df equal to the rank of **T**.

  - Create a function that Implement Wald's test (your function should take a fitted model, representing Ha, and a matrix of contrasts (T). The function should return the test-statistic, test DF, and the p-value.
  
   - Test youf function for the test in 3, compare your p-value with that of the F-test.
   
```{r}
 WTest=function(fm,T){
   DF=min(ncol(T),nrow(T))
   bHat=coef(fm)
   VCOV=vcov(fm)
   
   
   if(ncol(T)!=length(bHat)){ stop('The number of columns of T must be equal to the number of parameters in the model')}
   dHat=T%*%bHat
   V=T%*%VCOV%*%t(T)
   SS=t(dHat)%*%solve(V)%*%dHat
   pvalue=pchisq(q=SS,df=DF,lower.tail=FALSE)
   return(c('df'=DF,'Chisq'=SS,'pvalue'=pvalue))
 }
 
 anova(fm0,fm2)
 T=rbind(c(0,0,1,0,0),
         c(0,0,0,0,1))
 WTest(fm2,T)

```
